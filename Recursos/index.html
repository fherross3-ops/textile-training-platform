<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plataforma de Capacitación Textil</title>
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #e74c3c;
            --light-color: #ecf0f1;
            --success-color: #2ecc71;
            --warning-color: #f39c12;
            --text-color: #333;
            --border-radius: 6px;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background-color: #f5f7fa;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: var(--border-radius);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        h1, h2, h3 {
            color: var(--primary-color);
            margin-bottom: 20px;
        }
        
        h1 {
            text-align: center;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--secondary-color);
            margin-bottom: 30px;
        }
        
        .form-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            background-color: #f9f9f9;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            font-size: 16px;
        }
        
        textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        button {
            background-color: var(--secondary-color);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: background-color 0.3s;
        }
        
        button:hover {
            background-color: #2980b9;
        }
        
        .btn-primary {
            background-color: var(--secondary-color);
            display: block;
            width: 100%;
            margin-top: 20px;
        }
        
        .btn-primary:hover {
            background-color: #2980b9;
        }
        
        .btn-secondary {
            background-color: var(--primary-color);
        }
        
        .btn-secondary:hover {
            background-color: #1a252f;
        }
        
        .btn-success {
            background-color: var(--success-color);
        }
        
        .btn-success:hover {
            background-color: #25a25a;
        }
        
        .btn-warning {
            background-color: var(--warning-color);
        }
        
        .btn-warning:hover {
            background-color: #e67e22;
        }
        
        .btn-danger {
            background-color: var(--accent-color);
        }
        
        .btn-danger:hover {
            background-color: #c0392b;
        }
        
        .required::after {
            content: " *";
            color: var(--accent-color);
        }
        
        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .form-col {
            flex: 1;
        }
        
        .alert {
            padding: 10px;
            border-radius: var(--border-radius);
            margin-bottom: 20px;
            display: none;
        }
        
        .alert-success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .alert-error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .alert-info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        .process-selector {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .process-item {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .process-item:hover {
            background-color: #e3f2fd;
        }
        
        .process-item.selected {
            background-color: var(--secondary-color);
            color: white;
            border-color: var(--secondary-color);
        }
        
        .radio-group {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
        }
        
        .radio-option {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .radio-option input[type="radio"] {
            width: auto;
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .action-buttons button {
            flex: 1;
            min-width: 150px;
        }
        
        .repository-section {
            margin-top: 40px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            background-color: #f9f9f9;
        }
        
        .kpi-list {
            margin-top: 20px;
        }
        
        .kpi-item {
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            margin-bottom: 10px;
            background-color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .kpi-info {
            flex: 1;
        }
        
        .kpi-actions {
            display: flex;
            gap: 10px;
        }
        
        .kpi-actions button {
            padding: 8px 12px;
            font-size: 14px;
        }
        
        .hidden {
            display: none;
        }
        
        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
        }
        
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            background-color: #f1f1f1;
            border: 1px solid #ddd;
            border-bottom: none;
            border-radius: var(--border-radius) var(--border-radius) 0 0;
            margin-right: 5px;
        }
        
        .tab.active {
            background-color: white;
            border-bottom: 1px solid white;
            margin-bottom: -1px;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Estilos para la sección de recursos */
        .resources-header {
            background: linear-gradient(135deg, #2c3e50, #3498db);
            color: white;
            padding: 1rem;
            text-align: center;
            margin-bottom: 2rem;
        }
        
        .back-btn {
            display: inline-block;
            margin-bottom: 1rem;
            padding: 0.5rem 1rem;
            background: #3498db;
            color: white;
            text-decoration: none;
            border-radius: 4px;
        }
        
        .content-section {
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            margin-bottom: 1.5rem;
        }
        
        footer {
            text-align: center;
            margin-top: 2rem;
            padding: 1rem;
            background: #2c3e50;
            color: white;
        }
        
        /* Estilos para la sección de ejemplos */
        .example-section {
            margin-bottom: 40px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            background-color: #f9f9f9;
        }
        
        .example-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #ddd;
        }
        
        .example-title {
            font-size: 1.5rem;
            color: var(--primary-color);
        }
        
        .example-process {
            background-color: var(--secondary-color);
            color: white;
            padding: 5px 10px;
            border-radius: var(--border-radius);
            font-size: 0.9rem;
        }
        
        .example-form-group {
            margin-bottom: 15px;
            padding: 10px;
            background: white;
            border-radius: var(--border-radius);
            border: 1px solid #eee;
        }
        
        .example-form-label {
            font-weight: bold;
            display: block;
            margin-bottom: 5px;
            color: var(--primary-color);
        }
        
        .example-form-value {
            padding: 8px;
            background: #f8f9fa;
            border-radius: var(--border-radius);
            border-left: 3px solid var(--secondary-color);
        }
        
        .formula {
            font-family: monospace;
            background: #2c3e50;
            color: white;
            padding: 10px;
            border-radius: var(--border-radius);
            margin: 10px 0;
        }
        
        .example-action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        /* Estilos para impresión */
        @media print {
            body {
                background-color: white;
                padding: 0;
            }
            
            .container {
                box-shadow: none;
                padding: 15px;
                max-width: 100%;
            }
            
            .action-buttons, 
            .tabs,
            .repository-section,
            .btn-primary,
            .process-selector {
                display: none !important;
            }
            
            .form-section {
                border: 1px solid #ddd;
                background-color: white;
                page-break-inside: avoid;
                margin-bottom: 20px;
            }
            
            h1 {
                font-size: 24px;
                text-align: center;
                border-bottom: 2px solid #3498db;
                padding-bottom: 10px;
                margin-bottom: 20px;
            }
            
            h2 {
                font-size: 18px;
                color: #2c3e50;
                border-bottom: 1px solid #ddd;
                padding-bottom: 8px;
                margin-bottom: 15px;
            }
            
            .form-group {
                margin-bottom: 15px;
            }
            
            input, select, textarea {
                border: 1px solid #ddd;
                background-color: #f9f9f9;
                padding: 8px;
            }
            
            .radio-group {
                margin-bottom: 10px;
            }
            
            /* Mostrar valores seleccionados como texto normal */
            .process-item.selected {
                background-color: transparent;
                color: #333;
                border: 1px solid #ddd;
                font-weight: bold;
            }
            
            /* Ocultar todos los procesos no seleccionados */
            .process-item:not(.selected) {
                display: none;
            }
            
            /* Mostrar solo el proceso seleccionado */
            .process-selector {
                display: block;
                margin-bottom: 15px;
            }
            
            /* Estilo para valores de radio seleccionados */
            .radio-option input[type="radio"]:not(:checked) + label {
                display: none;
            }
            
            .radio-option input[type="radio"]:checked + label {
                display: block;
                font-weight: bold;
                margin-bottom: 10px;
            }
            
            .radio-option input[type="radio"] {
                display: none;
            }
            
            .radio-group {
                display: block;
            }
        }
        
        @media (max-width: 768px) {
            .form-row {
                flex-direction: column;
                gap: 0;
            }
            
            .process-selector {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }
            
            .radio-group {
                flex-direction: column;
                gap: 10px;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .kpi-item {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .kpi-actions {
                margin-top: 10px;
                width: 100%;
                justify-content: space-between;
            }
            
            .example-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .example-process {
                margin-top: 10px;
            }
            
            .example-action-buttons {
                flex-direction: column;
            }
        }
    </style>
    <!-- Librería para exportación a PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <!-- Librería para exportación a Word -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/docx/7.8.2/docx.js"></script>
    <!-- Librería para exportación/importación CSV -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
</head>
<body>
    <div class="container">
        <h1>Plataforma de Capacitación Textil</h1>
        
        <div class="tabs">
            <div class="tab active" data-tab="kpi">Diseño de KPI</div>
            <div class="tab" data-tab="examples">Ejemplos de KPI</div>
            <div class="tab" data-tab="resources">Recursos</div>
        </div>
        
        <div id="alertBox" class="alert"></div>
        
        <!-- Pestaña de KPI -->
        <div id="kpiTab" class="tab-content active">
            <!-- Formulario para Netlify (oculto) -->
            <form name="kpi-netlify-form" netlify netlify-honeypot="bot-field" hidden>
                <input type="text" name="kpiName">
                <input type="text" name="kpiDescription">
                <input type="text" name="kpiObjective">
                <input type="text" name="selectedProcess">
                <input type="text" name="variables">
                <input type="text" name="measurementUnit">
                <input type="text" name="formula">
                <input type="text" name="frequency">
                <input type="text" name="targetValue">
                <input type="text" name="minValue">
                <input type="text" name="maxValue">
                <input type="text" name="toleranceRange">
                <input type="text" name="sisgoGrafico">
                <input type="text" name="utilidadComentario">
                <input type="text" name="designResponsible">
                <input type="text" name="implementationResponsible">
                <input type="text" name="monitoringResponsible">
                <input type="text" name="emailContact">
            </form>
            
            <!-- Formulario principal (interfaz de usuario) -->
            <form id="kpiForm" name="kpiForm">
                <!-- Sección 1: Información básica del KPI -->
                <div class="form-section">
                    <h2>Información Básica del KPI</h2>
                    
                    <div class="form-group">
                        <label for="kpiName" class="required">Nombre del KPI</label>
                        <input type="text" id="kpiName" name="kpiName" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="kpiDescription" class="required">Descripción del KPI</label>
                        <textarea id="kpiDescription" name="kpiDescription" required></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="kpiObjective" class="required">Objetivo del KPI</label>
                        <textarea id="kpiObjective" name="kpiObjective" required></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="required">Proceso asociado</label>
                        <div class="process-selector">
                            <div class="process-item" data-process="planeacion">Planeación</div>
                            <div class="process-item" data-process="compras">Compras</div>
                            <div class="process-item" data-process="produccion">Producción</div>
                            <div class="process-item" data-process="calidad">Control de Calidad</div>
                            <div class="process-item" data-process="mantenimiento">Mantenimiento</div>
                            <div class="process-item" data-process="logistica">Logística</div>
                            <div class="process-item" data-process="ventas">Ventas</div>
                            <div class="process-item" data-process="innovacion">Innovación y Desarrollo</div>
                        </div>
                        <input type="hidden" id="selectedProcess" name="selectedProcess" required>
                    </div>
                </div>
                
                <!-- Sección 2: Especificaciones Técnicas -->
                <div class="form-section">
                    <h2>Especificaciones Técnicas</h2>
                    
                    <div class="form-group">
                        <label for="variables" class="required">Variables a medir</label>
                        <input type="text" id="variables" name="variables" required>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-col">
                            <div class="form-group">
                                <label for="measurementUnit" class="required">Unidad de medida</label>
                                <input type="text" id="measurementUnit" name="measurementUnit" required>
                            </div>
                        </div>
                        
                        <div class="form-col">
                            <div class="form-group">
                                <label for="formula" class="required">Fórmula de cálculo</label>
                                <input type="text" id="formula" name="formula" required>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-col">
                            <div class="form-group">
                                <label for="frequency" class="required">Frecuencia de medición</label>
                                <select id="frequency" name="frequency" required>
                                    <option value="">Seleccione una opción</option>
                                    <option value="diaria">Diaria</option>
                                    <option value="semanal">Semanal</option>
                                    <option value="quincenal">Quincenal</option>
                                    <option value="mensual">Mensual</option>
                                    <option value="trimestral">Trimestral</option>
                                    <option value="semestral">Semestral</option>
                                    <option value="anual">Anual</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-col">
                            <div class="form-group">
                                <label for="targetValue" class="required">Valor objetivo</label>
                                <input type="number" id="targetValue" name="targetValue" step="0.01" required>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-col">
                            <div class="form-group">
                                <label for="minValue">Valor mínimo aceptable</label>
                                <input type="number" id="minValue" name="minValue" step="0.01">
                            </div>
                        </div>
                        
                        <div class="form-col">
                            <div class="form-group">
                                <label for="maxValue">Valor máximo aceptable</label>
                                <input type="number" id="maxValue" name="maxValue" step="0.01">
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="toleranceRange">Rango de tolerancia</label>
                        <input type="text" id="toleranceRange" name="toleranceRange">
                    </div>
                    
                    <div class="form-group">
                        <label class="required">Sistema gráfico para visualización</label>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="grafico-lineas" name="sisgoGrafico" value="lineas" required>
                                <label for="grafico-lineas">Gráfico de líneas</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="grafico-barras" name="sisgoGrafico" value="barras">
                                <label for="grafico-barras">Gráfico de barras</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="grafico-torta" name="sisgoGrafico" value="torta">
                                <label for="grafico-torta">Gráfico de torta</label>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Sección 3: Utilidad y Aplicación -->
                <div class="form-section">
                    <h2>Utilidad y Aplicación</h2>
                    
                    <div class="form-group">
                        <label for="utilidadComentario" class="required">Comentarios sobre la utilidad del KPI</label>
                        <textarea id="utilidadComentario" name="utilidadComentario" required></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="designResponsible" class="required">Responsable del diseño</label>
                        <input type="text" id="designResponsible" name="designResponsible" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="implementationResponsible" class="required">Responsable de implementación</label>
                        <input type="text" id="implementationResponsible" name="implementationResponsible" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="monitoringResponsible" class="required">Responsable de monitoreo</label>
                        <input type="text" id="monitoringResponsible" name="monitoringResponsible" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="emailContact" class="required">Email de contacto</label>
                        <input type="email" id="emailContact" name="emailContact" required>
                    </div>
                </div>
                
                <button type="submit" class="btn-primary">Guardar KPI</button>
            </form>
            
            <!-- Botones de acción -->
            <div class="action-buttons">
                <button id="printBtn" class="btn-secondary">Imprimir</button>
                <button id="exportPdfBtn" class="btn-danger">Exportar a PDF</button>
                <button id="exportWordBtn" class="btn-secondary">Exportar a Word</button>
                <button id="exportCsvBtn" class="btn-success">Exportar a CSV</button>
                <button id="importCsvBtn" class="btn-warning">Importar desde CSV</button>
                <input type="file" id="csvFileInput" accept=".csv" style="display: none;">
            </div>
            
            <!-- Repositorio de KPIs guardados -->
            <div class="repository-section">
                <h2>KPIs Guardados</h2>
                <div id="kpiList" class="kpi-list">
                    <!-- Aquí se mostrarán los KPIs guardados -->
                </div>
            </div>
        </div>
        
        <!-- Pestaña de ejemplos -->
        <div id="examplesTab" class="tab-content">
            <div class="example-section">
                <div class="example-header">
                    <h3 class="example-title">Eficiencia General de Equipos (OEE)</h3>
                    <span class="example-process">Producción</span>
                </div>
                
                <div class="example-form-group">
                    <div class="example-form-label">Descripción</div>
                    <div class="example-form-value">Mide el porcentaje de tiempo que un equipo está produciendo productos de calidad a su máxima velocidad</div>
                </div>
                
                <div class="example-form-group">
                    <div class="example-form-label">Fórmula</div>
                    <div class="formula">OEE = Disponibilidad × Rendimiento × Calidad</div>
                </div>
                
                <div class="example-form-group">
                    <div class="example-form-label">Valor objetivo</div>
                    <div class="example-form-value">85%</div>
                </div>
                
                <div class="example-form-group">
                    <div class="example-form-label">Frecuencia de medición</div>
                    <div class="example-form-value">Diaria</div>
                </div>
                
                <div class="example-action-buttons">
                    <button class="btn-secondary" onclick="loadExample('oee')">Cargar este ejemplo</button>
                </div>
            </div>
            
            <div class="example-section">
                <div class="example-header">
                    <h3 class="example-title">Tasa de Defectos por Millón de Oportunidades (DPMO)</h3>
                    <span class="example-process">Control de Calidad</span>
                </div>
                
                <div class="example-form-group">
                    <div class="example-form-label">Descripción</div>
                    <div class="example-form-value">Mide la cantidad de defectos en un proceso por cada millón de oportunidades</div>
                </div>
                
                <div class="example-form-group">
                    <div class="example-form-label">Fórmula</div>
                    <div class="formula">DPMO = (Número de defectos / (Número de unidades × Oportunidades por unidad)) × 1,000,000</div>
                </div>
                
                <div class="example-form-group">
                    <div class="example-form-label">Valor objetivo</div>
                    <div class="example-form-value">3.4 (Nivel Six Sigma)</div>
                </div>
                
                <div class="example-form-group">
                    <div class="example-form-label">Frecuencia de medición</div>
                    <div class="example-form-value">Semanal</div>
                </div>
                
                <div class="example-action-buttons">
                    <button class="btn-secondary" onclick="loadExample('dpmo')">Cargar este ejemplo</button>
                </div>
            </div>
            
            <div class="example-section">
                <div class="example-header">
                    <h3 class="example-title">Tiempo de Ciclo de Producción</h3>
                    <span class="example-process">Producción</span>
                </div>
                
                <div class="example-form-group">
                    <div class="example-form-label">Descripción</div>
                    <div class="example-form-value">Mide el tiempo total desde el inicio hasta la finalización de un proceso de producción</div>
                </div>
                
                <div class="example-form-group">
                    <div class="example-form-label">Fórmula</div>
                    <div class="formula">Tiempo de ciclo = Tiempo de finalización - Tiempo de inicio</div>
                </div>
                
                <div class="example-form-group">
                    <div class="example-form-label">Valor objetivo</div>
                    <div class="example-form-value">4 horas (dependiendo del producto)</div>
                </div>
                
                <div class="example-form-group">
                    <div class="example-form-label">Frecuencia de medición</div>
                    <div class="example-form-value">Por lote</div>
                </div>
                
                <div class="example-action-buttons">
                    <button class="btn-secondary" onclick="loadExample('cycleTime')">Cargar este ejemplo</button>
                </div>
            </div>
        </div>
        
        <!-- Pestaña de recursos -->
        <div id="resourcesTab" class="tab-content">
            <div class="resources-header">
                <h2>Recursos de Capacitación</h2>
                <p>Material de apoyo para el diseño e implementación de KPIs</p>
            </div>
            
            <div class="content-section">
                <h3>Guías y Tutoriales</h3>
                <ul>
                    <li>Guía para diseñar KPIs efectivos</li>
                    <li>Cómo definir métricas alineadas con objetivos estratégicos</li>
                    <li>Plantilla para documentación de KPIs</li>
                    <li>Ejemplos de KPIs para la industria textil</li>
                </ul>
            </div>
            
            <div class="content-section">
                <h3>Plantillas Descargables</h3>
                <ul>
                    <li>Plantilla de formulario KPI (Excel)</li>
                    <li>Dashboard para visualización de KPIs</li>
                    <li>Formato de reporte de desempeño</li>
                </ul>
            </div>
            
            <div class="content-section">
                <h3>Videos de Capacitación</h3>
                <ul>
                    <li>Introducción a la medición del desempeño</li>
                    <li>Cómo calcular e interpretar KPIs</li>
                    <li>Casos de éxito en la industria textil</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        // Mapeo de nombres de procesos
        const processNames = {
            'planeacion': 'Planeación',
            'compras': 'Compras',
            'produccion': 'Producción',
            'calidad': 'Control de Calidad',
            'mantenimiento': 'Mantenimiento',
            'logistica': 'Logística',
            'ventas': 'Ventas',
            'innovacion': 'Innovación y Desarrollo'
        };

        // Inicialización
        document.addEventListener('DOMContentLoaded', function() {
            // Configurar selectores de proceso
            const processItems = document.querySelectorAll('.process-item');
            processItems.forEach(item => {
                item.addEventListener('click', function() {
                    processItems.forEach(i => i.classList.remove('selected'));
                    this.classList.add('selected');
                    document.getElementById('selectedProcess').value = this.getAttribute('data-process');
                });
            });

            // Configurar pestañas
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabName = this.getAttribute('data-tab');
                    
                    // Desactivar todas las pestañas
                    tabs.forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(tc => tc.classList.remove('active'));
                    
                    // Activar la pestaña seleccionada
                    this.classList.add('active');
                    document.getElementById(tabName + 'Tab').classList.add('active');
                });
            });

            // Configurar botones de acción
            document.getElementById('printBtn').addEventListener('click', function() {
                window.print();
            });

            document.getElementById('exportPdfBtn').addEventListener('click', exportToPdf);
            document.getElementById('exportWordBtn').addEventListener('click', exportToWord);
            document.getElementById('exportCsvBtn').addEventListener('click', exportToCsv);
            document.getElementById('importCsvBtn').addEventListener('click', function() {
                document.getElementById('csvFileInput').click();
            });
            
            document.getElementById('csvFileInput').addEventListener('change', importFromCsv);

            // Cargar KPIs guardados
            loadSavedKpis();

            // Configurar envío del formulario
            document.getElementById('kpiForm').addEventListener('submit', function(e) {
                e.preventDefault();
                if (validateForm()) {
                    saveKpi();
                }
            });
        });

        // Validar formulario
        function validateForm() {
            const form = document.getElementById('kpiForm');
            if (!form.checkValidity()) {
                showAlert('Por favor, complete todos los campos obligatorios', 'error');
                return false;
            }
            
            if (!document.getElementById('selectedProcess').value) {
                showAlert('Por favor, seleccione un proceso', 'error');
                return false;
            }
            
            return true;
        }

        // Mostrar alerta
        function showAlert(message, type) {
            const alertBox = document.getElementById('alertBox');
            alertBox.textContent = message;
            alertBox.className = 'alert';
            
            switch(type) {
                case 'success':
                    alertBox.classList.add('alert-success');
                    break;
                case 'error':
                    alertBox.classList.add('alert-error');
                    break;
                case 'info':
                    alertBox.classList.add('alert-info');
                    break;
            }
            
            alertBox.style.display = 'block';
            
            setTimeout(function() {
                alertBox.style.display = 'none';
            }, 5000);
        }

        // Guardar KPI
        function saveKpi() {
            const formData = new FormData(document.getElementById('kpiForm'));
            const kpiData = {};
            
            for (let [key, value] of formData.entries()) {
                kpiData[key] = value;
            }
            
            // Obtener KPIs existentes
            let savedKpis = JSON.parse(localStorage.getItem('kpis')) || [];
            
            // Agregar nuevo KPI
            kpiData.id = Date.now(); // ID único
            savedKpis.push(kpiData);
            
            // Guardar en localStorage
            localStorage.setItem('kpis', JSON.stringify(savedKpis));
            
            // Actualizar lista
            loadSavedKpis();
            
            // Mostrar mensaje de éxito
            showAlert('KPI guardado correctamente', 'success');
            
            // Reiniciar formulario
            document.getElementById('kpiForm').reset();
            document.querySelectorAll('.process-item').forEach(item => {
                item.classList.remove('selected');
            });
        }

        // Cargar KPIs guardados
        function loadSavedKpis() {
            const kpiList = document.getElementById('kpiList');
            kpiList.innerHTML = '';
            
            const savedKpis = JSON.parse(localStorage.getItem('kpis')) || [];
            
            if (savedKpis.length === 0) {
                kpiList.innerHTML = '<p>No hay KPIs guardados</p>';
                return;
            }
            
            savedKpis.forEach(kpi => {
                const kpiItem = document.createElement('div');
                kpiItem.className = 'kpi-item';
                
                kpiItem.innerHTML = `
                    <div class="kpi-info">
                        <h3>${kpi.kpiName}</h3>
                        <p><strong>Proceso:</strong> ${processNames[kpi.selectedProcess]}</p>
                        <p><strong>Objetivo:</strong> ${kpi.kpiObjective.substring(0, 100)}...</p>
                    </div>
                    <div class="kpi-actions">
                        <button class="btn-secondary" onclick="editKpi(${kpi.id})">Editar</button>
                        <button class="btn-danger" onclick="deleteKpi(${kpi.id})">Eliminar</button>
                    </div>
                `;
                
                kpiList.appendChild(kpiItem);
            });
        }

        // Editar KPI
        function editKpi(id) {
            const savedKpis = JSON.parse(localStorage.getItem('kpis')) || [];
            const kpi = savedKpis.find(k => k.id === id);
            
            if (!kpi) return;
            
            // Llenar formulario con datos del KPI
            document.getElementById('kpiName').value = kpi.kpiName || '';
            document.getElementById('kpiDescription').value = kpi.kpiDescription || '';
            document.getElementById('kpiObjective').value = kpi.kpiObjective || '';
            
            // Seleccionar proceso
            document.querySelectorAll('.process-item').forEach(item => {
                item.classList.remove('selected');
                if (item.getAttribute('data-process') === kpi.selectedProcess) {
                    item.classList.add('selected');
                }
            });
            document.getElementById('selectedProcess').value = kpi.selectedProcess || '';
            
            document.getElementById('variables').value = kpi.variables || '';
            document.getElementById('measurementUnit').value = kpi.measurementUnit || '';
            document.getElementById('formula').value = kpi.formula || '';
            document.getElementById('frequency').value = kpi.frequency || '';
            document.getElementById('targetValue').value = kpi.targetValue || '';
            document.getElementById('minValue').value = kpi.minValue || '';
            document.getElementById('maxValue').value = kpi.maxValue || '';
            document.getElementById('toleranceRange').value = kpi.toleranceRange || '';
            
            // Seleccionar sistema gráfico
            document.querySelectorAll('input[name="sisgoGrafico"]').forEach(radio => {
                radio.checked = (radio.value === kpi.sisgoGrafico);
            });
            
            document.getElementById('utilidadComentario').value = kpi.utilidadComentario || '';
            document.getElementById('designResponsible').value = kpi.designResponsible || '';
            document.getElementById('implementationResponsible').value = kpi.implementationResponsible || '';
            document.getElementById('monitoringResponsible').value = kpi.monitoringResponsible || '';
            document.getElementById('emailContact').value = kpi.emailContact || '';
            
            // Eliminar el KPI para luego guardarlo editado
            deleteKpi(id, false);
            
            // Desplazar al inicio del formulario
            window.scrollTo(0, 0);
            
            showAlert('KPI cargado para edición', 'info');
        }

        // Eliminar KPI
        function deleteKpi(id, showMessage = true) {
            let savedKpis = JSON.parse(localStorage.getItem('kpis')) || [];
            savedKpis = savedKpis.filter(k => k.id !== id);
            
            localStorage.setItem('kpis', JSON.stringify(savedKpis));
            loadSavedKpis();
            
            if (showMessage) {
                showAlert('KPI eliminado correctamente', 'success');
            }
        }

        // Exportar a PDF
        function exportToPdf() {
            // Verificar si jsPDF está disponible
            if (typeof jspdf !== 'undefined' && jspdf.jsPDF) {
                const doc = new jspdf.jsPDF();
                
                // Título
                doc.setFontSize(18);
                doc.text('Plataforma de Capacitación Textil - KPI', 15, 15);
                
                // Obtener datos del formulario
                const formData = new FormData(document.getElementById('kpiForm'));
                
                let yPosition = 30;
                
                // Información básica
                doc.setFontSize(14);
                doc.text('Información Básica del KPI', 15, yPosition);
                yPosition += 10;
                
                doc.setFontSize(12);
                doc.text(`Nombre: ${formData.get('kpiName')}`, 15, yPosition);
                yPosition += 7;
                doc.text(`Descripción: ${formData.get('kpiDescription')}`, 15, yPosition);
                yPosition += 7;
                doc.text(`Objetivo: ${formData.get('kpiObjective')}`, 15, yPosition);
                yPosition += 7;
                doc.text(`Proceso: ${processNames[formData.get('selectedProcess')]}`, 15, yPosition);
                yPosition += 12;
                
                // Especificaciones técnicas
                doc.setFontSize(14);
                doc.text('Especificaciones Técnicas', 15, yPosition);
                yPosition += 10;
                
                doc.setFontSize(12);
                doc.text(`Variables: ${formData.get('variables')}`, 15, yPosition);
                yPosition += 7;
                doc.text(`Unidad de medida: ${formData.get('measurementUnit')}`, 15, yPosition);
                yPosition += 7;
                doc.text(`Fórmula: ${formData.get('formula')}`, 15, yPosition);
                yPosition += 7;
                doc.text(`Frecuencia: ${formData.get('frequency')}`, 15, yPosition);
                yPosition += 7;
                doc.text(`Valor objetivo: ${formData.get('targetValue')}`, 15, yPosition);
                yPosition += 7;
                doc.text(`Valor mínimo: ${formData.get('minValue')}`, 15, yPosition);
                yPosition += 7;
                doc.text(`Valor máximo: ${formData.get('maxValue')}`, 15, yPosition);
                yPosition += 7;
                doc.text(`Rango de tolerancia: ${formData.get('toleranceRange')}`, 15, yPosition);
                yPosition += 7;
                doc.text(`Sistema gráfico: ${formData.get('sisgoGrafico')}`, 15, yPosition);
                yPosition += 12;
                
                // Utilidad y aplicación
                doc.setFontSize(14);
                doc.text('Utilidad y Aplicación', 15, yPosition);
                yPosition += 10;
                
                doc.setFontSize(12);
                doc.text(`Comentarios: ${formData.get('utilidadComentario')}`, 15, yPosition);
                yPosition += 7;
                doc.text(`Diseño: ${formData.get('designResponsible')}`, 15, yPosition);
                yPosition += 7;
                doc.text(`Implementación: ${formData.get('implementationResponsible')}`, 15, yPosition);
                yPosition += 7;
                doc.text(`Monitoreo: ${formData.get('monitoringResponsible')}`, 15, yPosition);
                yPosition += 7;
                doc.text(`Email: ${formData.get('emailContact')}`, 15, yPosition);
                
                // Guardar PDF
                doc.save('kpi_formulario.pdf');
                
                showAlert('Formulario exportado a PDF correctamente', 'success');
            } else {
                showAlert('Error: No se pudo cargar la librería para exportar a PDF', 'error');
            }
        }

        // Exportar a Word
        function exportToWord() {
            showAlert('Funcionalidad de exportación a Word en desarrollo', 'info');
        }

        // Exportar a CSV
        function exportToCsv() {
            const formData = new FormData(document.getElementById('kpiForm'));
            const data = {};
            
            for (let [key, value] of formData.entries()) {
                data[key] = value;
            }
            
            // Convertir a CSV
            const csvContent = Papa.unparse([data]);
            
            // Descargar archivo
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            
            link.setAttribute('href', url);
            link.setAttribute('download', 'kpi_formulario.csv');
            link.style.visibility = 'hidden';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showAlert('Formulario exportado a CSV correctamente', 'success');
        }

        // Importar desde CSV
        function importFromCsv(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            Papa.parse(file, {
                header: true,
                complete: function(results) {
                    if (results.data && results.data.length > 0) {
                        const data = results.data[0];
                        
                        // Llenar formulario con datos importados
                        document.getElementById('kpiName').value = data.kpiName || '';
                        document.getElementById('kpiDescription').value = data.kpiDescription || '';
                        document.getElementById('kpiObjective').value = data.kpiObjective || '';
                        
                        // Seleccionar proceso
                        document.querySelectorAll('.process-item').forEach(item => {
                            item.classList.remove('selected');
                            if (item.getAttribute('data-process') === data.selectedProcess) {
                                item.classList.add('selected');
                            }
                        });
                        document.getElementById('selectedProcess').value = data.selectedProcess || '';
                        
                        document.getElementById('variables').value = data.variables || '';
                        document.getElementById('measurementUnit').value = data.measurementUnit || '';
                        document.getElementById('formula').value = data.formula || '';
                        document.getElementById('frequency').value = data.frequency || '';
                        document.getElementById('targetValue').value = data.targetValue || '';
                        document.getElementById('minValue').value = data.minValue || '';
                        document.getElementById('maxValue').value = data.maxValue || '';
                        document.getElementById('toleranceRange').value = data.toleranceRange || '';
                        
                        // Seleccionar sistema gráfico
                        document.querySelectorAll('input[name="sisgoGrafico"]').forEach(radio => {
                            radio.checked = (radio.value === data.sisgoGrafico);
                        });
                        
                        document.getElementById('utilidadComentario').value = data.utilidadComentario || '';
                        document.getElementById('designResponsible').value = data.designResponsible || '';
                        document.getElementById('implementationResponsible').value = data.implementationResponsible || '';
                        document.getElementById('monitoringResponsible').value = data.monitoringResponsible || '';
                        document.getElementById('emailContact').value = data.emailContact || '';
                        
                        showAlert('Datos importados correctamente desde CSV', 'success');
                    } else {
                        showAlert('Error: El archivo CSV no contiene datos válidos', 'error');
                    }
                    
                    // Limpiar input de archivo
                    event.target.value = '';
                },
                error: function(error) {
                    showAlert('Error al importar el archivo CSV: ' + error.message, 'error');
                    event.target.value = '';
                }
            });
        }

        // Cargar ejemplo
        function loadExample(exampleType) {
            let exampleData = {};
            
            switch(exampleType) {
                case 'oee':
                    exampleData = {
                        kpiName: 'Eficiencia General de Equipos (OEE)',
                        kpiDescription: 'Mide el porcentaje de tiempo que un equipo está produciendo productos de calidad a su máxima velocidad',
                        kpiObjective: 'Maximizar la utilización de los equipos de producción y identificar oportunidades de mejora',
                        selectedProcess: 'produccion',
                        variables: 'Tiempo de funcionamiento, producción real, producción teórica, unidades defectuosas',
                        measurementUnit: 'Porcentaje',
                        formula: 'OEE = Disponibilidad × Rendimiento × Calidad',
                        frequency: 'diaria',
                        targetValue: '85',
                        minValue: '70',
                        maxValue: '100',
                        toleranceRange: '±5%',
                        sisgoGrafico: 'lineas',
                        utilidadComentario: 'Permite identificar cuellos de botella en la producción y oportunidades para mejorar la eficiencia',
                        designResponsible: 'Jefe de Producción',
                        implementationResponsible: 'Supervisor de Turno',
                        monitoringResponsible: 'Analista de Producción',
                        emailContact: 'produccion@empresa.com'
                    };
                    break;
                    
                case 'dpmo':
                    exampleData = {
                        kpiName: 'Tasa de Defectos por Millón de Oportunidades (DPMO)',
                        kpiDescription: 'Mide la cantidad de defectos en un proceso por cada millón de oportunidades',
                        kpiObjective: 'Reducir los defectos en el proceso productivo y alcanzar niveles Six Sigma',
                        selectedProcess: 'calidad',
                        variables: 'Número de defectos, número de unidades, oportunidades por unidad',
                        measurementUnit: 'Defectos por millón',
                        formula: 'DPMO = (Número de defectos / (Número de unidades × Oportunidades por unidad)) × 1,000,000',
                        frequency: 'semanal',
                        targetValue: '3.4',
                        minValue: '0',
                        maxValue: '100',
                        toleranceRange: 'N/A',
                        sisgoGrafico: 'barras',
                        utilidadComentario: 'Proporciona una métrica estandarizada para comparar la calidad entre diferentes procesos y productos',
                        designResponsible: 'Jefe de Calidad',
                        implementationResponsible: 'Inspector de Calidad',
                        monitoringResponsible: 'Analista de Calidad',
                        emailContact: 'calidad@empresa.com'
                    };
                    break;
                    
                case 'cycleTime':
                    exampleData = {
                        kpiName: 'Tiempo de Ciclo de Producción',
                        kpiDescription: 'Mide el tiempo total desde el inicio hasta la finalización de un proceso de producción',
                        kpiObjective: 'Reducir el tiempo de producción para aumentar la capacidad y cumplir con los plazos de entrega',
                        selectedProcess: 'produccion',
                        variables: 'Tiempo de inicio, tiempo de finalización',
                        measurementUnit: 'Horas',
                        formula: 'Tiempo de ciclo = Tiempo de finalización - Tiempo de inicio',
                        frequency: 'diaria',
                        targetValue: '4',
                        minValue: '3',
                        maxValue: '6',
                        toleranceRange: '±0.5 horas',
                        sisgoGrafico: 'lineas',
                        utilidadComentario: 'Ayuda a identificar ineficiencias en el proceso y establecer estándares de tiempo',
                        designResponsible: 'Jefe de Producción',
                        implementationResponsible: 'Supervisor de Turno',
                        monitoringResponsible: 'Analista de Producción',
                        emailContact: 'produccion@empresa.com'
                    };
                    break;
            }
            
            // Llenar formulario con datos del ejemplo
            document.getElementById('kpiName').value = exampleData.kpiName || '';
            document.getElementById('kpiDescription').value = exampleData.kpiDescription || '';
            document.getElementById('kpiObjective').value = exampleData.kpiObjective || '';
            
            // Seleccionar proceso
            document.querySelectorAll('.process-item').forEach(item => {
                item.classList.remove('selected');
                if (item.getAttribute('data-process') === exampleData.selectedProcess) {
                    item.classList.add('selected');
                }
            });
            document.getElementById('selectedProcess').value = exampleData.selectedProcess || '';
            
            document.getElementById('variables').value = exampleData.variables || '';
            document.getElementById('measurementUnit').value = exampleData.measurementUnit || '';
            document.getElementById('formula').value = exampleData.formula || '';
            document.getElementById('frequency').value = exampleData.frequency || '';
            document.getElementById('targetValue').value = exampleData.targetValue || '';
            document.getElementById('minValue').value = exampleData.minValue || '';
            document.getElementById('maxValue').value = exampleData.maxValue || '';
            document.getElementById('toleranceRange').value = exampleData.toleranceRange || '';
            
            // Seleccionar sistema gráfico
            document.querySelectorAll('input[name="sisgoGrafico"]').forEach(radio => {
                radio.checked = (radio.value === exampleData.sisgoGrafico);
            });
            
            document.getElementById('utilidadComentario').value = exampleData.utilidadComentario || '';
            document.getElementById('designResponsible').value = exampleData.designResponsible || '';
            document.getElementById('implementationResponsible').value = exampleData.implementationResponsible || '';
            document.getElementById('monitoringResponsible').value = exampleData.monitoringResponsible || '';
            document.getElementById('emailContact').value = exampleData.emailContact || '';
            
            // Cambiar a la pestaña de KPI
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(tc => tc.classList.remove('active'));
            
            document.querySelector('.tab[data-tab="kpi"]').classList.add('active');
            document.getElementById('kpiTab').classList.add('active');
            
            showAlert('Ejemplo cargado correctamente. Revise y adapte los valores según sea necesario.', 'info');
        }
    </script>
</body>
</html>
